<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>socket聊天室 | fanxblog</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/blog/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/blog/css/screen.css" />
  <meta name="generator" content="fanxblog">
  <script src="https://static.duoshuo.com/embed.js"></script>
  
  
  

  

</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/blog/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/11/24/电影大鱼/">电影《大鱼》</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/11/01/制作小游戏/">自制小游戏</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/10/29/重排与重绘/">重排与重绘</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/10/27/从无到有的网页/">从无到有的网页</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/10/24/随笔htmlcss滚动效果/">随笔(html+css滚动效果)</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/10/19/排序/">排序</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/10/11/深度克隆对象/">深度克隆对象</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/09/30/html5中的多媒体调用/">html5中的多媒体调用</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/09/21/jquery滚动条插件scrollbar/">jquery滚动条插件——scrollbar</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/09/19/阿里月饼事件/">阿里月饼事件</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/09/19/我的电影世界/">我的电影世界</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/28/久石让的音乐/">久石让的音乐</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/27/js的事件绑定与解绑/">js的事件绑定与解绑</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/21/jQuery解析初级篇/">jQuery解析初级篇</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/18/在线五子棋游戏/">在线五子棋游戏</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/12/socket聊天室/">socket聊天室</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/10/canvas五子棋/">canvas五子棋</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/03/table的特性/">table的特性</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/08/02/AngularJs入门/">AngularJs入门</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/28/客户端Excel浏览与下载/">客户端Excel浏览与下载</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/22/优雅的Sublime-Text/">优雅的Sublime Text</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/21/Canvas-对图片加水印/">Canvas 对图片加水印</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/20/web上传图片原理/">web上传图片原理</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/14/jquery事件绑定/">jquery事件绑定</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/03/javascript原型/">javascript原型</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/07/02/javascript闭包浅谈/">javascript闭包浅谈</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/blog/2016/06/18/博客第一篇/">博客第一篇</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/jquery-插件-网站开发/">&nbsp;&nbsp;&nbsp;jquery 插件 网站开发</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/小游戏/">&nbsp;&nbsp;&nbsp;小游戏</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/杂谈/">&nbsp;&nbsp;&nbsp;杂谈</a>
                                    <small>2</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/杂谈-music/">&nbsp;&nbsp;&nbsp;杂谈 music</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/杂谈-电影/">&nbsp;&nbsp;&nbsp;杂谈 电影</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/电影-杂谈/">&nbsp;&nbsp;&nbsp;电影 杂谈</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-AngularJs/">&nbsp;&nbsp;&nbsp;网站开发 AngularJs</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-H5/">&nbsp;&nbsp;&nbsp;网站开发 H5</a>
                                    <small>3</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-JQuery/">&nbsp;&nbsp;&nbsp;网站开发 JQuery</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-css-js/">&nbsp;&nbsp;&nbsp;网站开发 css js</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-html/">&nbsp;&nbsp;&nbsp;网站开发 html</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-jQuery/">&nbsp;&nbsp;&nbsp;网站开发 jQuery</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-js/">&nbsp;&nbsp;&nbsp;网站开发 js</a>
                                    <small>5</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-nodeJS/">&nbsp;&nbsp;&nbsp;网站开发 nodeJS</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-socket/">&nbsp;&nbsp;&nbsp;网站开发 socket</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-socket-nodeJs-H5/">&nbsp;&nbsp;&nbsp;网站开发 socket nodeJs H5</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-下载/">&nbsp;&nbsp;&nbsp;网站开发 下载</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-工具/">&nbsp;&nbsp;&nbsp;网站开发 工具</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-性能/">&nbsp;&nbsp;&nbsp;网站开发 性能</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/blog/tags/网站开发-随笔-html-css/">&nbsp;&nbsp;&nbsp;网站开发 随笔 html css</a>
                                    <small>1</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li class="mp-pjax"><a class="fa fa-user" href="/blog/about">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/blog/2016/11/24/电影大鱼/">电影《大鱼》</a>
                
                    <a  data-pjax href="/blog/2016/11/01/制作小游戏/">自制小游戏</a>
                
                    <a  data-pjax href="/blog/2016/10/29/重排与重绘/">重排与重绘</a>
                
                    <a  data-pjax href="/blog/2016/10/27/从无到有的网页/">从无到有的网页</a>
                
                    <a  data-pjax href="/blog/2016/10/24/随笔htmlcss滚动效果/">随笔(html+css滚动效果)</a>
                
                    <a  data-pjax href="/blog/2016/10/19/排序/">排序</a>
                
                    <a  data-pjax href="/blog/2016/10/11/深度克隆对象/">深度克隆对象</a>
                
                    <a  data-pjax href="/blog/2016/09/30/html5中的多媒体调用/">html5中的多媒体调用</a>
                
                    <a  data-pjax href="/blog/2016/09/21/jquery滚动条插件scrollbar/">jquery滚动条插件——scrollbar</a>
                
                    <a  data-pjax href="/blog/2016/09/19/阿里月饼事件/">阿里月饼事件</a>
                
                    <a  data-pjax href="/blog/2016/09/19/我的电影世界/">我的电影世界</a>
                
                    <a  data-pjax href="/blog/2016/08/28/久石让的音乐/">久石让的音乐</a>
                
                    <a  data-pjax href="/blog/2016/08/27/js的事件绑定与解绑/">js的事件绑定与解绑</a>
                
                    <a  data-pjax href="/blog/2016/08/21/jQuery解析初级篇/">jQuery解析初级篇</a>
                
                    <a  data-pjax href="/blog/2016/08/18/在线五子棋游戏/">在线五子棋游戏</a>
                
                    <a  data-pjax href="/blog/2016/08/12/socket聊天室/">socket聊天室</a>
                
                    <a  data-pjax href="/blog/2016/08/10/canvas五子棋/">canvas五子棋</a>
                
                    <a  data-pjax href="/blog/2016/08/03/table的特性/">table的特性</a>
                
                    <a  data-pjax href="/blog/2016/08/02/AngularJs入门/">AngularJs入门</a>
                
                    <a  data-pjax href="/blog/2016/07/28/客户端Excel浏览与下载/">客户端Excel浏览与下载</a>
                
                    <a  data-pjax href="/blog/2016/07/22/优雅的Sublime-Text/">优雅的Sublime Text</a>
                
                    <a  data-pjax href="/blog/2016/07/21/Canvas-对图片加水印/">Canvas 对图片加水印</a>
                
                    <a  data-pjax href="/blog/2016/07/20/web上传图片原理/">web上传图片原理</a>
                
                    <a  data-pjax href="/blog/2016/07/14/jquery事件绑定/">jquery事件绑定</a>
                
                    <a  data-pjax href="/blog/2016/07/03/javascript原型/">javascript原型</a>
                
                    <a  data-pjax href="/blog/2016/07/02/javascript闭包浅谈/">javascript闭包浅谈</a>
                
                    <a  data-pjax href="/blog/2016/06/18/博客第一篇/">博客第一篇</a>
                
                
                
                    <a data-pjax href="/blog/tags/jquery-插件-网站开发/">&nbsp;&nbsp;jquery 插件 网站开发</a>
                
                    <a data-pjax href="/blog/tags/小游戏/">&nbsp;&nbsp;小游戏</a>
                
                    <a data-pjax href="/blog/tags/杂谈/">&nbsp;&nbsp;杂谈</a>
                
                    <a data-pjax href="/blog/tags/杂谈-music/">&nbsp;&nbsp;杂谈 music</a>
                
                    <a data-pjax href="/blog/tags/杂谈-电影/">&nbsp;&nbsp;杂谈 电影</a>
                
                    <a data-pjax href="/blog/tags/电影-杂谈/">&nbsp;&nbsp;电影 杂谈</a>
                
                    <a data-pjax href="/blog/tags/网站开发-AngularJs/">&nbsp;&nbsp;网站开发 AngularJs</a>
                
                    <a data-pjax href="/blog/tags/网站开发-H5/">&nbsp;&nbsp;网站开发 H5</a>
                
                    <a data-pjax href="/blog/tags/网站开发-JQuery/">&nbsp;&nbsp;网站开发 JQuery</a>
                
                    <a data-pjax href="/blog/tags/网站开发-css-js/">&nbsp;&nbsp;网站开发 css js</a>
                
                    <a data-pjax href="/blog/tags/网站开发-html/">&nbsp;&nbsp;网站开发 html</a>
                
                    <a data-pjax href="/blog/tags/网站开发-jQuery/">&nbsp;&nbsp;网站开发 jQuery</a>
                
                    <a data-pjax href="/blog/tags/网站开发-js/">&nbsp;&nbsp;网站开发 js</a>
                
                    <a data-pjax href="/blog/tags/网站开发-nodeJS/">&nbsp;&nbsp;网站开发 nodeJS</a>
                
                    <a data-pjax href="/blog/tags/网站开发-socket/">&nbsp;&nbsp;网站开发 socket</a>
                
                    <a data-pjax href="/blog/tags/网站开发-socket-nodeJs-H5/">&nbsp;&nbsp;网站开发 socket nodeJs H5</a>
                
                    <a data-pjax href="/blog/tags/网站开发-下载/">&nbsp;&nbsp;网站开发 下载</a>
                
                    <a data-pjax href="/blog/tags/网站开发-工具/">&nbsp;&nbsp;网站开发 工具</a>
                
                    <a data-pjax href="/blog/tags/网站开发-性能/">&nbsp;&nbsp;网站开发 性能</a>
                
                    <a data-pjax href="/blog/tags/网站开发-随笔-html-css/">&nbsp;&nbsp;网站开发 随笔 html css</a>
                
                <a data-pjax class="fa fa-user" href="/blog/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" data-pjax href="/blog/">fanxblog</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">socket聊天室</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/blog/tags/网站开发-socket/' style='color:#D5D5D5'>网站开发 socket</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">socket聊天室</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2016-08-12T09:29:08.000Z"
                              itemprop="datePublished">2016-08-12</time>
                    </div>
    </span>

        <section class="post-content">
            <p>soclet在俗称“套接字”，它是连接应用层和传输层之间的桥梁，大概是把，反正百度上是这么说的，一般我们要从服务器上获取到数据图片或者文件通常是从浏览器端主动发出请求后服务器做出响应，但是通常服务器不能主动的向浏览器发送消息，而socket帮我们解决了这个问题，在网站开发中这个技术最常用的场景是做即时聊天功能，通常一些购物网站上会有这样的聊天功能，比如淘宝网页的旺旺，在学习socket的时候我做了一个聊天室，这个聊天室实现了公共聊天和私聊两种功能，nodejs+express+socket.io结合。</p>
<p>这个聊天室的demo链接是：<a href="http://139.129.48.163:3000/chat" target="_blank" rel="external">http://139.129.48.163:3000/chat</a></p>
<p>接下来是是在nodejs后台代码：</p>
<p><pre id="js">//在线用户<br>var onlineUsers = {};<br>//当前在线人数<br>var onlineCount = 0;</pre></p>
<p>var io = require(‘socket.io’)(server);<br>io.on(‘connection’,function(socket){<br>    console.log(“new msg”);</p>
<pre><code>socket.on(&apos;chat message&apos;, function (from,to,data) {
  var json=[];
  json.push(onlineUsers[from]);
  json.push(from);
  json.push(data);
    io.emit(&apos;chat message&apos;,json);
});

socket.on(&apos;private message&apos;, function (from,to,data) {
var json=[];
json.push(onlineUsers[from]);
json.push(from);
json.push(data);
    io.emit(&apos;to&apos;+to,json);
})

//监听新用户加入
socket.on(&apos;login&apos;, function(obj){
    //将新加入用户的唯一标识当作socket的名称，后面退出的时候会用到
    socket.name = obj.userid;
    //检查在线列表，如果不在里面就加入
    if(!onlineUsers.hasOwnProperty(obj.userid)) {
        onlineUsers[obj.userid] = obj.username;
        //在线人数+1
        onlineCount++;
    }
    //向所有客户端广播用户加入
    io.emit(&apos;login&apos;, {onlineUsers:onlineUsers, onlineCount:onlineCount, user:obj.username});
    console.log(obj.username+&apos;加入了聊天室&apos;);
});
//监听用户退出
socket.on(&apos;disconnect&apos;, function(){
    //将退出的用户从在线列表中删除
    if(onlineUsers.hasOwnProperty(socket.name)) {
        //退出用户的信息
        var obj = {userid:socket.name, username:onlineUsers[socket.name]};
        //删除
        delete onlineUsers[socket.name];
        //在线人数-1
        onlineCount--;
        //向所有客户端广播用户退出
        io.emit(&apos;logout&apos;, {onlineUsers:onlineUsers, onlineCount:onlineCount, user:obj});
    }
});
</code></pre><p>});<br>这段代码放在express中的app.js中或者bin目录下的www中，这取决于<code>var server = http.createServer(app);</code>开启服务的是在app.js还是在www。<br>接下来是前端页面上的代码,这里就简要的写一下：</p>
<p><pre id="js">var socket = io();<br>var chatType,id,name;<br>$(“#confirm”).click(function(){<br>    if($(“#username”).val().length &lt; 3||$(“#username”).val().length &gt; 8)<br>        return;<br>    id=”c”+parseInt(Math.random()*10000);<br>    name=$(“#username”).val();<br>    $(“#login,#bg”).hide();</pre></p>
<pre><code>socket.emit(&apos;login&apos;, {&quot;userid&quot;:id,&quot;username&quot;:name});

socket.on(&apos;login&apos;, function (data) {
    $(&apos;#chat_contents .commonality .chat_content&apos;).append(&quot;&lt;div class=&apos;tips&apos;&gt;&lt;span&gt;欢迎用户&quot;+data.user+&quot;加入房间&lt;/span&gt;&lt;/div&gt;&quot;);
    $(&quot;#userList ul&quot;).html(&quot;&quot;);
    $(&quot;#userList .user_num&quot;).html(&quot;在线人数：&quot;+data.onlineCount);
    for(key in data.onlineUsers){
        if(key!=id)
            $(&quot;#userList ul&quot;).prepend(&quot;&lt; li value=&quot;+key+&quot;&gt;&quot;+data.onlineUsers[key]+&quot; &lt; small&gt;[&lt;i&gt;&quot;+key+&quot;&lt;/i&gt;]&lt; /small&gt;&lt; /li&gt;&quot;);
        else
            $(&quot;#userList .self&quot;).html(&quot;&lt;span&gt;name:&lt;/span&gt;&lt;big&gt;&quot;+data.onlineUsers[key]+&quot;&lt;/big&gt;&lt;br /&gt;&lt;span&gt;id:&lt;/span&gt;&quot;+key)
    }
    event();
});
submit();
socket.on(&apos;to&apos;+id, function(data) {
    var username=data[0];
    var userid=data[1];
    var msg=data[2];

    eventfn(userid,username);
    var time=new Date();
    var h=time.getHours(),m=time.getMinutes(),s=time.getSeconds();
    var ele=$(&apos;.&apos;+userid);
    ele.find(&quot;.chat_content&quot;).append(&quot;&lt;div class=&apos;other&apos;&gt;&quot;+
        &quot;&lt; div class=&apos;text&apos;&gt;&quot;+h+&quot;:&quot;+m+&quot;:&quot;+s+&quot;&lt; /div&gt;&quot;+
        &quot;&lt; span class=&apos;username&apos;&gt;&quot;+username+&quot;&lt; /span&gt;&lt;span class=&apos;msg&apos;&gt;&quot;+msg+&quot;&lt; /span&gt;&lt; /div&gt;&quot;);
    ele.scrollTop(ele.find(&quot;.chat_content&quot;).height()-ele.height());
});

socket.on(&apos;chat message&apos;, function (data) {
    var username=data[0];
    var userid=data[1];
    var msg=data[2];
    if(userid= =id){
        var c=&quot;me&quot;;
    }else{
        var c=&quot;other&quot;;
    }
    var time=new Date();
    var h=time.getHours(),m=time.getMinutes(),s=time.getSeconds();
    var ele=$(&quot;.commonality&quot;);
    ele.find(&apos;.chat_content&apos;).append(&quot;&lt;div class=&quot;+c+&quot;&gt;&quot;+
        &quot;&lt; div class=&apos;text&apos;&gt;&quot;+h+&quot;:&quot;+m+&quot;:&quot;+s+&quot;&lt; /div&gt;&quot;+
        &quot;&lt; span class=&apos;username&apos;&gt;&quot;+username+&quot;&lt; /span&gt;&lt; span class=&apos;msg&apos;&gt;&quot;+msg+&quot;&lt; /span&gt;&lt; /div&gt;&quot;);
    $(&quot;.commonality_title&quot;).trigger(&quot;click&quot;);
    ele.scrollTop(ele.find(&quot;.chat_content&quot;).height()-ele.height());
});
</code></pre><p>});<br>function event(){<br>    $(“#userList ul li”).off();<br>    $(“#userList ul li”).on(“dblclick”,function(){</p>
<pre><code>        var userid=$(this).attr(&quot;value&quot;);
        var username=$(this).html();
    if(userid!=id)
        eventfn(userid,username);

});
</code></pre><p>}<br>function eventfn(userid,username){<br>    if($(“#tab_title”).find(“.”+userid).length&gt;0){<br>            $(“#tab_title”).find(“.”+userid).trigger(“click”);<br>        }else{<br>            $(“#tab_title ul”).append(“&lt; li class=’title “+userid+”‘&gt;&lt; span class=’text’&gt;”+username+”&lt; /span&gt;&lt; span class=’close’&gt;x&lt; /span&gt;&lt; /li&gt;”);</p>
<pre><code>    $(&quot;#chat_contents&quot;).append(&apos;&lt; li class=&quot;&apos;+userid+&apos;&quot; value=&quot;&apos;+userid+&apos;&quot;&gt;&apos;+
            &apos;&lt; div class=&quot;chat_content&quot;&gt;&lt;div class=&quot;tips&quot;&gt;&lt; span&gt;可以和&apos;+username+&apos;聊天了&lt; /span&gt;&lt; /div&gt;&lt; /div&gt;&apos;+
            &apos;&lt; div class=&quot;chat_submit&quot;&gt;&apos;+
                &apos;&lt; input type=&quot;text&quot; class=&quot;input&quot;&gt;&apos;+
                &apos;&lt; button class=&quot;submit&quot;&gt;提交&lt;/button&gt;&apos;+
            &apos;&lt; /div&gt;&apos;+
        &apos;&lt; /li&gt;&apos;);
}   

 $(&quot;#tab_title .title&quot;).each(function(index){
    $(this).off();
    $(this).on(&quot;click&quot;,function(){
        $(&quot;#tab_title .title&quot;).removeClass(&quot;active&quot;);
        $(this).addClass(&quot;active&quot;);
        $(&quot;#chat_contents&gt;li&quot;).removeClass(&quot;active&quot;);
        $(&quot;#chat_contents&gt;li&quot;).eq(index).addClass(&quot;active&quot;);
        $(&quot;#tab_title h1&quot;).html($(this).find(&quot;.text&quot;).html());
    });
});

 $(&quot;#tab_title&quot;).find(&quot;.&quot;+ userid).trigger(&quot;click&quot;);

$(&quot;#tab_title .title .close&quot;).each(function(index){
    $(this).off();
    $(this).on(&quot;click&quot;,function(){
        $(this).parents(&quot;li&quot;).remove();
        $(&quot;#chat_contents&gt;li&quot;).eq(index+1).remove();
        $(&quot;.commonality_title&quot;).trigger(&quot;click&quot;);
    })
});
submit();
</code></pre><p>}<br>function submit(){<br>        $(“.submit”).off()<br>        $(‘.submit’).on(“click”,function(){<br>                var value=$(this).parent().find(“.input”).val();console.log(value);<br>                var to=$(this).parents(“li”).attr(“value”);<br>                if(to= =”commonality”)<br>                socket.emit(‘chat message’,id,to,value);<br>                else{<br>                    socket.emit(‘private message’,id,to,value);<br>                    var time=new Date();<br>                    var h=time.getHours(),m=time.getMinutes(),s=time.getSeconds();<br>                    var ele=$(‘.’+to);<br>                    ele.find(“.chat_content”).append(“&lt;  div class=’me’&gt;”+<br>                        “&lt; div class=’text’&gt;”+h+”:”+m+”:”+s+”&lt; /div&gt;”+<br>                        “&lt; span class=’username’&gt;”+name+”&lt;/ span&gt;&lt; span class=’msg’&gt;”+value+”&lt; /span&gt;&lt; /div&gt;”);<br>                    ele.scrollTop(ele.find(“.chat_content”).height()-ele.height());<br>                }<br>                $(‘.input’).val(‘’);<br>                return false;<br>        });<br>}<br>浏览器需要使用socket必须要加载socket.io.js。</p>

        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/blog/2016/08/18/在线五子棋游戏/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/blog/2016/08/10/canvas五子棋/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/blog/"></a> &copy; fanxblog 2014</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>
    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>
  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/blog/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/blog/js/lib.js"></script>
<script type="text/javascript" src="/blog/js/main.js"></script>







</body>
</html>
